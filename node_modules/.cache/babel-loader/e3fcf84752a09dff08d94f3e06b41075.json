{"ast":null,"code":"var _jsxFileName = \"/Users/sher/Desktop/newShaurma/shaurmarket/src/Context/ClientContext.jsx\",\n    _s = $RefreshSig$();\n\nimport axios from 'axios';\nimport React, { useReducer } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { AUTH_API, JSON_API } from '../helpers/constants';\nimport { calcSubPrice, calcTotalPrice } from '../helpers/function';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const clientContext = /*#__PURE__*/React.createContext();\nconst INIT_STATE = {\n  products: null,\n  productsCountInCart: JSON.parse(localStorage.getItem('cart')) ? JSON.parse(localStorage.getItem(\"cart\")).products.length : 0,\n  cartData: null\n};\n\nconst reducer = (state = INIT_STATE, action) => {\n  switch (action.type) {\n    case \"GET_PRODUCTS\":\n      return { ...state,\n        products: action.payload\n      };\n\n    case \"GET_CART\":\n      return { ...state,\n        cartData: action.payload\n      };\n\n    case \"ADD_AND_DELETE_PRODUCT_IN_CART\":\n      return { ...state,\n        productsCountInCart: action.payload\n      };\n\n    case \"DELETE_CART_PRODUCT\":\n      return { ...state,\n        productsCountInCart: action.payload\n      };\n\n    default:\n      return state;\n  }\n};\n\nconst ClientContextProvider = ({\n  children\n}) => {\n  _s();\n\n  const [state, dispatch] = useReducer(reducer, INIT_STATE);\n  const history = useHistory();\n\n  const getProducts = async () => {\n    const search = new URLSearchParams(window.location.search);\n    search.set('_limit', 4);\n    history ? history.push(`${history.location.pathname}?${search.toString()}`) : console.log(null);\n    const {\n      data\n    } = await axios(`${JSON_API}/${window.location.search}`);\n    dispatch({\n      type: \"GET_PRODUCTS\",\n      payload: data\n    });\n  };\n\n  function addAndDeleteProductInCart(product) {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newProduct = {\n      product: product,\n      count: 1,\n      subPrice: 0\n    };\n    newProduct.subPrice = calcSubPrice(newProduct);\n    let newCart = cart.products.filter(item => item.product.id === product.id);\n\n    if (newCart.length > 0) {\n      cart.products = cart.products.filter(item => item.product.id !== product.id);\n    } else {\n      cart.products.push(newProduct);\n    }\n\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem('cart', JSON.stringify(cart));\n    dispatch({\n      type: \"ADD_AND_DELETE_PRODUCT_IN_CART\",\n      payload: cart.products.length\n    });\n  }\n\n  function deleteCartProducts(id) {\n    let toDelete = JSON.parse(localStorage.getItem(\"cart\"));\n    toDelete.products = toDelete.products.filter(item => item.product.id !== id);\n    toDelete.totalPrice = calcTotalPrice(toDelete.products);\n    localStorage.setItem(\"cart\", JSON.stringify(toDelete));\n    console.log(toDelete.products.length);\n    getCart();\n    dispatch({\n      type: \"DELETE_CART_PRODUCT\",\n      payload: toDelete.products.length\n    });\n  }\n\n  function checkProductInCart(id) {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newCart = cart.products.filter(item => item.product.id === id);\n    return newCart.length > 0 ? true : false;\n  }\n\n  function getCart() {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n\n    if (!cart) {\n      cart = {\n        products: []\n      };\n    }\n\n    dispatch({\n      type: \"GET_CART\",\n      payload: cart.products\n    });\n  }\n\n  function changeCountProduct(count, id) {\n    let cart = JSON.parse(localStorage.getItem('cart'));\n    cart.products = cart.products.map(item => {\n      if (item.product.id === id) {\n        item.count = count;\n        item.subPrice = calcSubPrice(item);\n      }\n\n      return item;\n    });\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    getCart();\n  }\n\n  const registerUser = async (newUser, history) => {\n    try {\n      const res = await axios.post(`${AUTH_API}/registration`, newUser);\n      console.log(res);\n      history.push('/signin');\n    } catch {\n      alert(\"Неправильная почта или пароль\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(clientContext.Provider, {\n    value: {\n      products: state.products,\n      productsCountInCart: state.productsCountInCart,\n      cartData: state.cartData,\n      getProducts,\n      registerUser,\n      addAndDeleteProductInCart,\n      checkProductInCart,\n      getCart,\n      changeCountProduct,\n      deleteCartProducts\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 139,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ClientContextProvider, \"aqS5x1VamWbXcdOcY3KJaIFmnfw=\", false, function () {\n  return [useHistory];\n});\n\n_c = ClientContextProvider;\nexport default ClientContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ClientContextProvider\");","map":{"version":3,"sources":["/Users/sher/Desktop/newShaurma/shaurmarket/src/Context/ClientContext.jsx"],"names":["axios","React","useReducer","useHistory","AUTH_API","JSON_API","calcSubPrice","calcTotalPrice","clientContext","createContext","INIT_STATE","products","productsCountInCart","JSON","parse","localStorage","getItem","length","cartData","reducer","state","action","type","payload","ClientContextProvider","children","dispatch","history","getProducts","search","URLSearchParams","window","location","set","push","pathname","toString","console","log","data","addAndDeleteProductInCart","product","cart","totalPrice","newProduct","count","subPrice","newCart","filter","item","id","setItem","stringify","deleteCartProducts","toDelete","getCart","checkProductInCart","changeCountProduct","map","registerUser","newUser","res","post","alert"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport React, { useReducer } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { AUTH_API, JSON_API } from '../helpers/constants';\nimport { calcSubPrice, calcTotalPrice } from '../helpers/function';\n\nexport const clientContext = React.createContext()\n\nconst INIT_STATE = {\n    products: null,\n    productsCountInCart: JSON.parse(localStorage.getItem('cart')) ? JSON.parse(localStorage.getItem(\"cart\")).products.length : 0,\n    cartData: null,\n}\n\nconst reducer = (state = INIT_STATE, action) => {\n    switch (action.type) {\n        case \"GET_PRODUCTS\":\n            return { ...state, products: action.payload }\n        case \"GET_CART\":\n            return { ...state, cartData: action.payload }\n        case \"ADD_AND_DELETE_PRODUCT_IN_CART\":\n            return { ...state, productsCountInCart: action.payload }\n        case \"DELETE_CART_PRODUCT\":\n            return { ...state, productsCountInCart: action.payload }\n        default:\n            return state\n    }\n}\n\nconst ClientContextProvider = ({ children }) => {\n\n    const [state, dispatch] = useReducer(reducer, INIT_STATE)\n    const history = useHistory()\n\n    const getProducts = async () => {\n        const search = new URLSearchParams(window.location.search);\n        search.set('_limit', 4)\n        history ? (history.push(`${history.location.pathname}?${search.toString()}`)) : (console.log(null))\n        const { data } = await axios(`${JSON_API}/${window.location.search}`)\n        dispatch({\n            type: \"GET_PRODUCTS\",\n            payload: data\n        })\n    }\n\n    function addAndDeleteProductInCart(product) {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        let newProduct = {\n            product: product,\n            count: 1,\n            subPrice: 0\n        }\n        newProduct.subPrice = calcSubPrice(newProduct)\n        let newCart = cart.products.filter(item => item.product.id === product.id)\n        if (newCart.length > 0) {\n            cart.products = cart.products.filter(item => item.product.id !== product.id)\n        }\n        else {\n            cart.products.push(newProduct)\n        }\n        cart.totalPrice = calcTotalPrice(cart.products)\n        localStorage.setItem('cart', JSON.stringify(cart))\n        dispatch({\n            type: \"ADD_AND_DELETE_PRODUCT_IN_CART\",\n            payload: cart.products.length\n        })\n    }\n\n    function deleteCartProducts(id) {\n        let toDelete = JSON.parse(localStorage.getItem(\"cart\"));\n        toDelete.products = toDelete.products.filter((item) => item.product.id !== id);\n        toDelete.totalPrice = calcTotalPrice(toDelete.products)\n        localStorage.setItem(\"cart\", JSON.stringify(toDelete))\n        console.log(toDelete.products.length)\n        getCart()\n        dispatch({\n            type: \"DELETE_CART_PRODUCT\",\n            payload: toDelete.products.length\n        })\n    }\n\n    function checkProductInCart(id) {\n        let cart = JSON.parse(localStorage.getItem(\"cart\"))\n        if (!cart) {\n            cart = {\n                products: [],\n                totalPrice: 0\n            }\n        }\n        let newCart = cart.products.filter(item => item.product.id === id)\n        return newCart.length > 0 ? true : false\n    }\n\n    function getCart() {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        if (!cart) {\n            cart = {\n                products: []\n            }\n        }\n        dispatch({\n            type: \"GET_CART\",\n            payload: cart.products\n        })\n    }\n\n    function changeCountProduct(count, id) {\n        let cart = JSON.parse(localStorage.getItem('cart'))\n        cart.products = cart.products.map(item => {\n            if (item.product.id === id) {\n                item.count = count\n                item.subPrice = calcSubPrice(item)\n            }\n            return item\n        })\n        cart.totalPrice = calcTotalPrice(cart.products)\n        localStorage.setItem(\"cart\", JSON.stringify(cart))\n        getCart()\n    }\n\n    const registerUser = async (newUser, history) => {\n        try {\n            const res = await axios.post(`${AUTH_API}/registration`, newUser)\n            console.log(res);\n            history.push('/signin')\n        }\n        catch {\n            alert(\"Неправильная почта или пароль\")\n        }\n    }\n\n    return (\n        <clientContext.Provider value={{\n            products: state.products,\n            productsCountInCart: state.productsCountInCart,\n            cartData: state.cartData,\n            getProducts,\n            registerUser,\n            addAndDeleteProductInCart,\n            checkProductInCart,\n            getCart,\n            changeCountProduct,\n            deleteCartProducts\n        }}>\n            {children}\n        </clientContext.Provider>\n    );\n};\n\nexport default ClientContextProvider;"]},"metadata":{},"sourceType":"module"}